<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Blog Creation with Images</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
          Cantarell, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 40px 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
      }

      .header p {
        font-size: 1.1rem;
        opacity: 0.9;
      }

      .content {
        padding: 40px 30px;
      }

      .form-section {
        margin-bottom: 30px;
      }

      .form-section h2 {
        font-size: 1.3rem;
        color: #333;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid #667eea;
      }

      .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
      }

      .form-grid.full {
        grid-template-columns: 1fr;
      }

      .form-group {
        display: flex;
        flex-direction: column;
      }

      label {
        font-weight: 600;
        color: #333;
        margin-bottom: 8px;
        font-size: 0.95rem;
      }

      input[type="text"],
      input[type="email"],
      input[type="number"],
      select,
      textarea {
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 6px;
        font-size: 1rem;
        font-family: inherit;
        transition: all 0.3s ease;
      }

      input[type="text"]:focus,
      input[type="email"]:focus,
      input[type="number"]:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      textarea {
        resize: vertical;
        min-height: 120px;
        font-family: "Courier New", monospace;
        font-size: 0.9rem;
      }

      .file-input-wrapper {
        position: relative;
        overflow: hidden;
        display: inline-block;
        width: 100%;
      }

      .file-input-label {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 30px;
        border: 2px dashed #667eea;
        border-radius: 6px;
        background: #f9f9f9;
        cursor: pointer;
        transition: all 0.3s ease;
        min-height: 100px;
      }

      .file-input-label:hover {
        background: #f0f0ff;
        border-color: #764ba2;
      }

      .file-input-wrapper input[type="file"] {
        position: absolute;
        left: -9999px;
      }

      .file-info {
        display: flex;
        align-items: center;
        gap: 10px;
        color: #667eea;
      }

      .file-list {
        margin-top: 10px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }

      .file-tag {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        background: #eef2ff;
        color: #667eea;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 500;
      }

      .file-tag button {
        background: none;
        border: none;
        color: #667eea;
        cursor: pointer;
        font-size: 1.2rem;
        padding: 0;
        line-height: 1;
      }

      .file-tag button:hover {
        color: #764ba2;
      }

      .preview-gallery {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 10px;
        margin-top: 15px;
      }

      .preview-item {
        position: relative;
        border-radius: 6px;
        overflow: hidden;
        background: #f0f0f0;
        aspect-ratio: 1;
      }

      .preview-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .preview-item button {
        position: absolute;
        top: 5px;
        right: 5px;
        background: rgba(0, 0, 0, 0.5);
        color: white;
        border: none;
        border-radius: 50%;
        width: 28px;
        height: 28px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        transition: background 0.2s;
      }

      .preview-item button:hover {
        background: rgba(0, 0, 0, 0.8);
      }

      .button-group {
        display: flex;
        gap: 10px;
        margin-top: 30px;
      }

      button {
        padding: 14px 28px;
        font-size: 1rem;
        font-weight: 600;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .btn-submit {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        flex: 1;
      }

      .btn-submit:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
      }

      .btn-submit:active {
        transform: translateY(0);
      }

      .btn-reset {
        background: #e0e0e0;
        color: #333;
      }

      .btn-reset:hover {
        background: #d0d0d0;
      }

      .loading {
        display: none;
        text-align: center;
        margin-top: 20px;
      }

      .spinner {
        display: inline-block;
        width: 40px;
        height: 40px;
        border: 4px solid #f0f0f0;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .alert {
        padding: 15px;
        border-radius: 6px;
        margin-bottom: 20px;
        display: none;
      }

      .alert.show {
        display: block;
      }

      .alert.success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .alert.error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .alert.warning {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
      }

      .response-section {
        margin-top: 40px;
        padding: 20px;
        background: #f9f9f9;
        border-radius: 6px;
        max-height: 400px;
        overflow-y: auto;
        display: none;
      }

      .response-section.show {
        display: block;
      }

      .response-section h3 {
        color: #333;
        margin-bottom: 10px;
      }

      pre {
        background: #333;
        color: #0f0;
        padding: 15px;
        border-radius: 4px;
        overflow-x: auto;
        font-size: 0.85rem;
        line-height: 1.4;
      }

      .hint {
        font-size: 0.85rem;
        color: #666;
        margin-top: 5px;
        font-style: italic;
      }

      .required {
        color: #e74c3c;
      }

      @media (max-width: 768px) {
        .form-grid {
          grid-template-columns: 1fr;
        }

        .header h1 {
          font-size: 1.8rem;
        }

        .content {
          padding: 20px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üìù Create Blog with Images</h1>
        <p>Test the blog creation API with featured image and gallery images</p>
      </div>

      <div class="content">
        <div id="alert" class="alert"></div>

        <form id="blogForm" enctype="multipart/form-data">
          <!-- Text Fields Section -->
          <div class="form-section">
            <h2>üìÑ Blog Content</h2>

            <div class="form-grid">
              <div class="form-group">
                <label for="title"
                  >Blog Title <span class="required">*</span></label
                >
                <input
                  type="text"
                  id="title"
                  name="title"
                  placeholder="e.g., Getting Started with Web Development"
                  required
                />
                <div class="hint">The title of your blog post</div>
              </div>

              <div class="form-group">
                <label for="slug"
                  >URL Slug <span class="required">*</span></label
                >
                <input
                  type="text"
                  id="slug"
                  name="slug"
                  placeholder="e.g., getting-started-web-dev"
                  required
                />
                <div class="hint">
                  URL-friendly identifier (lowercase, hyphens only)
                </div>
              </div>
            </div>

            <div class="form-grid full">
              <div class="form-group">
                <label for="excerpt">Excerpt / Short Description</label>
                <input
                  type="text"
                  id="excerpt"
                  name="excerpt"
                  placeholder="Optional: Brief summary of the post"
                />
                <div class="hint">A short preview of the blog post</div>
              </div>
            </div>

            <div class="form-grid full">
              <div class="form-group">
                <label for="content"
                  >Content (JSON) <span class="required">*</span></label
                >
                <textarea
                  id="content"
                  name="content"
                  placeholder='Enter blog content as plain text or JSON...&#10;&#10;Example:&#10;{&#10;  "blocks": [&#10;    { "type": "paragraph", "text": "Your content here..." }&#10;  ]&#10;}'
                  required
                ></textarea>
                <div class="hint">
                  Can be plain text or structured JSON. Images will be appended
                  automatically.
                </div>
              </div>
            </div>
          </div>

          <!-- Metadata Section -->
          <div class="form-section">
            <h2>üè∑Ô∏è Metadata</h2>

            <div class="form-grid">
              <div class="form-group">
                <label for="category">Category</label>
                <input
                  type="text"
                  id="category"
                  name="category"
                  placeholder="e.g., technology"
                  value=""
                />
                <div class="hint">Category slug (must exist)</div>
              </div>

              <div class="form-group">
                <label for="status">Status</label>
                <select id="status" name="status">
                  <option value="draft">Draft</option>
                  <option value="published">Published</option>
                  <option value="review">Review</option>
                  <option value="scheduled">Scheduled</option>
                </select>
                <div class="hint">Publication status</div>
              </div>
            </div>

            <div class="form-grid full">
              <div class="form-group">
                <label for="tags">Tags (comma-separated)</label>
                <input
                  type="text"
                  id="tags"
                  name="tags"
                  placeholder="e.g., web, tutorial, javascript"
                />
                <div class="hint">
                  Tag slugs separated by commas (must exist)
                </div>
              </div>
            </div>
          </div>

          <!-- Featured Image Section -->
          <div class="form-section">
            <h2>üñºÔ∏è Featured Image</h2>

            <div class="form-group">
              <label for="featured_image">Featured Image</label>
              <div class="file-input-wrapper">
                <label for="featured_image" class="file-input-label">
                  <div class="file-info">
                    <span>üìÅ Choose featured image or drag & drop</span>
                  </div>
                </label>
                <input
                  type="file"
                  id="featured_image"
                  name="featured_image"
                  accept="image/*"
                />
              </div>
              <div id="featuredPreview"></div>
              <div class="hint">
                Max 2MB. Supported: JPEG, PNG, GIF, WebP, SVG
              </div>
            </div>
          </div>

          <!-- Gallery Images Section -->
          <div class="form-section">
            <h2>üé® Gallery Images</h2>

            <div class="form-group">
              <label for="images">Upload Gallery Images</label>
              <div class="file-input-wrapper">
                <label for="images" class="file-input-label">
                  <div class="file-info">
                    <span>üìÅ Choose images or drag & drop multiple</span>
                  </div>
                </label>
                <input
                  type="file"
                  id="images"
                  name="images"
                  accept="image/*"
                  multiple
                />
              </div>
              <div id="imagesList" class="file-list"></div>
              <div id="galleryPreview" class="preview-gallery"></div>
              <div class="hint">
                Max 2MB each, up to 10 images. These will be added to the blog
                content.
              </div>
            </div>
          </div>

          <!-- Submit Section -->
          <div class="button-group">
            <button type="submit" class="btn-submit">
              üöÄ Publish Blog Post
            </button>
            <button type="reset" class="btn-reset">Clear Form</button>
          </div>

          <div class="loading" id="loading">
            <div class="spinner"></div>
            <p style="margin-top: 10px; color: #667eea">
              Publishing your blog post...
            </p>
          </div>
        </form>

        <!-- Response Section -->
        <div id="responseSection" class="response-section">
          <h3>‚úÖ Response</h3>
          <pre id="responseContent"></pre>
        </div>
      </div>
    </div>

    <script>
      const form = document.getElementById("blogForm")
      const alertEl = document.getElementById("alert")
      const loadingEl = document.getElementById("loading")
      const responseSection = document.getElementById("responseSection")
      const responseContent = document.getElementById("responseContent")
      const featuredImageInput = document.getElementById("featured_image")
      const imagesInput = document.getElementById("images")
      const featuredPreview = document.getElementById("featuredPreview")
      const imagesListEl = document.getElementById("imagesList")
      const galleryPreviewEl = document.getElementById("galleryPreview")

      // Get auth token from localStorage
      function getAuthToken() {
        const token = localStorage.getItem("auth_token")
        if (!token) {
          showAlert(
            'Please log in first. Store your auth token in localStorage as "auth_token".',
            "warning",
          )
          return null
        }
        return token
      }

      function showAlert(message, type = "info") {
        alertEl.textContent = message
        alertEl.className = `alert show ${type}`
        setTimeout(() => {
          alertEl.classList.remove("show")
        }, 5000)
      }

      function formatJSON(obj) {
        return JSON.stringify(obj, null, 2)
      }

      // Drag and drop for featured image
      const featuredLabel = document.querySelector(
        'label[for="featured_image"]',
      )
      featuredLabel.addEventListener("dragover", (e) => {
        e.preventDefault()
        e.stopPropagation()
        featuredLabel.style.background = "#eef2ff"
      })

      featuredLabel.addEventListener("dragleave", () => {
        featuredLabel.style.background = ""
      })

      featuredLabel.addEventListener("drop", (e) => {
        e.preventDefault()
        e.stopPropagation()
        featuredLabel.style.background = ""
        const files = e.dataTransfer.files
        if (files.length > 0) {
          featuredImageInput.files = files
          handleFeaturedImageChange()
        }
      })

      // Featured image change handler
      featuredImageInput.addEventListener("change", handleFeaturedImageChange)

      function handleFeaturedImageChange() {
        const file = featuredImageInput.files[0]
        featuredPreview.innerHTML = ""
        if (file) {
          const reader = new FileReader()
          reader.onload = (e) => {
            const img = document.createElement("img")
            img.src = e.target.result
            img.style.maxWidth = "200px"
            img.style.borderRadius = "6px"
            img.style.marginTop = "10px"
            featuredPreview.appendChild(img)
          }
          reader.readAsDataURL(file)
        }
      }

      // Drag and drop for gallery images
      const imagesLabel = document.querySelector('label[for="images"]')
      imagesLabel.addEventListener("dragover", (e) => {
        e.preventDefault()
        e.stopPropagation()
        imagesLabel.style.background = "#eef2ff"
      })

      imagesLabel.addEventListener("dragleave", () => {
        imagesLabel.style.background = ""
      })

      imagesLabel.addEventListener("drop", (e) => {
        e.preventDefault()
        e.stopPropagation()
        imagesLabel.style.background = ""
        const files = e.dataTransfer.files
        if (files.length > 0) {
          imagesInput.files = files
          handleImagesChange()
        }
      })

      // Gallery images change handler
      imagesInput.addEventListener("change", handleImagesChange)

      function handleImagesChange() {
        const files = Array.from(imagesInput.files || [])
        imagesListEl.innerHTML = ""
        galleryPreviewEl.innerHTML = ""

        files.forEach((file, index) => {
          // File tag
          const tag = document.createElement("div")
          tag.className = "file-tag"
          tag.innerHTML = `
          <span>${file.name}</span>
          <button type="button" data-index="${index}">√ó</button>
        `
          imagesListEl.appendChild(tag)

          // Preview
          const reader = new FileReader()
          reader.onload = (e) => {
            const previewDiv = document.createElement("div")
            previewDiv.className = "preview-item"
            previewDiv.innerHTML = `
            <img src="${e.target.result}" alt="${file.name}">
            <button type="button" data-index="${index}">√ó</button>
          `
            galleryPreviewEl.appendChild(previewDiv)
          }
          reader.readAsDataURL(file)
        })

        // Remove buttons
        document
          .querySelectorAll(".file-tag button, .preview-item button")
          .forEach((btn) => {
            btn.addEventListener("click", (e) => {
              e.preventDefault()
              const index = parseInt(e.target.dataset.index)
              const newFiles = new DataTransfer()
              files.forEach((f, i) => {
                if (i !== index) newFiles.items.add(f)
              })
              imagesInput.files = newFiles.files
              handleImagesChange()
            })
          })
      }

      // Auto-generate slug from title
      document.getElementById("title").addEventListener("change", (e) => {
        const slug = e.target.value
          .toLowerCase()
          .trim()
          .replace(/[^\w\s-]/g, "")
          .replace(/\s+/g, "-")
          .replace(/-+/g, "-")
          .replace(/^-+|-+$/g, "")

        if (slug && !document.getElementById("slug").value) {
          document.getElementById("slug").value = slug
        }
      })

      // Form submission
      form.addEventListener("submit", async (e) => {
        e.preventDefault()

        const token = getAuthToken()
        if (!token) return

        loadingEl.style.display = "block"
        responseSection.classList.remove("show")

        const formData = new FormData()
        formData.append("title", document.getElementById("title").value)
        formData.append("slug", document.getElementById("slug").value)
        formData.append("content", document.getElementById("content").value)
        formData.append("excerpt", document.getElementById("excerpt").value)
        formData.append("status", document.getElementById("status").value)

        const category = document.getElementById("category").value
        if (category) formData.append("category", category)

        const tags = document.getElementById("tags").value
        if (tags) {
          formData.append(
            "tags",
            JSON.stringify(tags.split(",").map((t) => t.trim())),
          )
        }

        // Add featured image
        if (featuredImageInput.files[0]) {
          formData.append("featured_image", featuredImageInput.files[0])
        }

        // Add gallery images
        Array.from(imagesInput.files || []).forEach((file) => {
          formData.append("images", file)
        })

        try {
          const response = await fetch("/api/blog-pages/create-with-images", {
            method: "POST",
            headers: {
              Authorization: `Bearer ${token}`,
            },
            body: formData,
          })

          const data = await response.json()

          if (!response.ok) {
            showAlert(
              `Error: ${data.error || "Failed to create blog post"}`,
              "error",
            )
            loadingEl.style.display = "none"
            responseContent.textContent = formatJSON(data)
            responseSection.classList.add("show")
            return
          }

          showAlert("Blog post created successfully!", "success")
          responseContent.textContent = formatJSON(data)
          responseSection.classList.add("show")
          form.reset()
          featuredPreview.innerHTML = ""
          imagesListEl.innerHTML = ""
          galleryPreviewEl.innerHTML = ""
        } catch (error) {
          showAlert(`Error: ${error.message}`, "error")
          responseContent.textContent = error.message
          responseSection.classList.add("show")
        } finally {
          loadingEl.style.display = "none"
        }
      })

      // Form reset handler
      form.addEventListener("reset", () => {
        featuredPreview.innerHTML = ""
        imagesListEl.innerHTML = ""
        galleryPreviewEl.innerHTML = ""
        responseSection.classList.remove("show")
      })

      console.log(
        "Blog creation test page loaded. Make sure to set your auth token in localStorage.",
      )
    </script>
  </body>
</html>
